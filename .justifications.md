# Justifications and False Positives

This document tracks false positive findings from security scanners, AI reviews, and architectural decisions that may appear as issues but are intentional design choices.

## False Positives

### 1. API Keys in .env File (False Positive)

**Finding**: QA review reported "exposed API keys in .env file"  
**Status**: FALSE POSITIVE  
**Date**: 2025-08-05  
**Justification**:

- The `.env` file is properly excluded in `.gitignore` (line 18)
- No `.env` file exists in git history
- The file contains only local development API keys for Task Master AI
- This is a standard practice for local development environments
- Production deployments use secure environment variable management

**Evidence**:

```bash
git ls-files | grep -E "\.env$"  # No output - file not tracked
grep -n "\.env" .gitignore       # Line 18: .env
```

## Architectural Decision Records (ADRs)

### ADR-001: Singleton Pattern for Managers

**Decision**: Use singleton pattern for UserDefaultsManager  
**Status**: ACCEPTED  
**Date**: 2025-07-01  
**Context**:

- macOS menu bar apps have a single app instance lifecycle
- UserDefaults is inherently a singleton in the OS
- Dependency injection would add unnecessary complexity for this use case

**Justification**:

- The singleton pattern matches the macOS app lifecycle model
- UserDefaultsManager wraps system-level singleton (UserDefaults)
- All access is through protocols for testability
- Mock implementations are provided for testing

**Trade-offs**:

- (+) Simpler code for menu bar app context
- (+) Matches platform conventions
- (-) Slightly harder to test in isolation
- (-) May trigger SOLID principle warnings

### ADR-002: AppController Responsibilities

**Decision**: Keep AppController as central coordinator  
**Status**: UNDER REVIEW  
**Date**: 2025-08-05  
**Context**:

- AppController manages app lifecycle in menu bar context
- SwiftUI limitations require centralized state management
- macOS AppDelegate pattern encourages central coordination

**Current State**:

- Acknowledged that AppController has multiple responsibilities
- Planning refactor in future sprint (3-5 days effort)
- Will extract: AppStateMachine, GracePeriodManager, AppEventLogger

**Justification for Deferral**:

- Current implementation works correctly
- Extensive test coverage (95.2%) ensures safety
- Refactoring is medium priority (P2)
- No user-facing issues

## Security Design Decisions

### Script Execution Path Validation

**Finding**: Script execution lacks path traversal protection  
**Status**: ACKNOWLEDGED - TO BE FIXED  
**Priority**: P1 (High)  
**Justification for Current State**:

- Feature is marked as experimental in UI
- Requires user authentication to configure
- Scripts must be explicitly enabled by user
- Planning to add validation in current PR

### Authentication Error Messages

**Finding**: Generic error messages for authentication failures  
**Status**: ACKNOWLEDGED - TO BE FIXED  
**Priority**: P1 (High)  
**Justification for Current State**:

- Current implementation functional but not optimal UX
- Easy fix (1 hour effort)
- Will implement specific messages for empty vs too-long reasons

## Testing Decisions

### Protocol-Based Testing Strategy

**Decision**: Use protocol-based dependency injection for testing  
**Status**: ACCEPTED  
**Justification**:

- Enables 95.2% test coverage
- Separates business logic from system integration
- Allows testing without system side effects
- See: [Testing Guide](docs/maintainers/testing-guide.md)

### CI Mode for Tests

**Decision**: Use CI=true environment variable for test behavior  
**Status**: ACCEPTED  
**Justification**:

- Prevents system dialogs during automated testing
- Adjusts timeouts for CI environment
- Enables additional logging for debugging
- Industry standard practice

## How to Update This Document

1. When a false positive is identified, add it to the False Positives section
2. When making architectural decisions that may trigger warnings, document as ADR
3. Include evidence and justification for each entry
4. Reference this file in PR descriptions when relevant
5. AI agents will consult this file to avoid re-flagging known issues
