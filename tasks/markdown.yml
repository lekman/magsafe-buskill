# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"
tasks:
  default:
    desc: List available Markdown tasks
    silent: true
    cmds:
      - task --list | grep "^\\* markdown:" | grep -v "::" || true
  lint:
    desc: Lint Markdown files
    silent: true
    cmds:
      - "echo \"\U0001F50D Linting Markdown files...\"\n\n# Check if markdownlint is installed\nif ! command -v markdownlint &> /dev/null; then\n  echo \"⚠️  markdownlint not installed\"\n  echo \"   Run: task markdown:setup\"\n  exit 1\nfi\n\n# Run the linter\nif markdownlint '**/*.md' --ignore node_modules --ignore .build; then\n  echo \"✅ Markdown lint passed\"\nelse\n  echo \"❌ Markdown lint found issues\"\n  echo \"\"\n  echo \"Run 'task markdown:lint:fix' to auto-fix what's possible\"\n  exit 1\nfi\n"
  lint:fix:
    desc: Fix Markdown formatting issues automatically
    silent: true
    cmds:
      - "echo \"\U0001F527 Fixing Markdown formatting issues...\"\n\n# Check if markdownlint is installed\nif ! command -v markdownlint &> /dev/null; then\n  echo \"⚠️  markdownlint not installed\"\n  echo \"   Run: task markdown:setup\"\n  exit 1\nfi\n\n# Fix all markdown files\necho \"Running markdown formatter...\"\nmarkdownlint '**/*.md' --ignore node_modules --ignore .build --fix\necho \"✅ Markdown files formatted\"\n\n# Show which files were modified\necho \"\"\necho \"Modified files:\"\ngit diff --name-only | grep '\\.md$' || echo \"  No changes needed\"\n"
  setup:
    desc: Setup markdownlint CLI tool
    silent: true
    cmds:
      - "echo \"\U0001F527 Setting up markdownlint...\"\n\n# Detect OS\nOS=$(uname -s | tr '[:upper:]' '[:lower:]')\n\nif [ \"$OS\" != \"darwin\" ]; then\n  echo \"⚠️  This task is optimized for macOS\"\n  echo \"   For other platforms, please install markdownlint manually\"\n  exit 0\nfi\n\n# Check if already installed\nif command -v markdownlint &> /dev/null; then\n  echo \"✅ markdownlint is already installed ($(markdownlint --version))\"\n  \n  # Check for updates\n  if command -v npm &> /dev/null && npm list -g markdownlint-cli &>/dev/null; then\n    CURRENT_VERSION=$(markdownlint --version | grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+' | head -1)\n    LATEST_VERSION=$(npm view markdownlint-cli version 2>/dev/null)\n    if [ \"$CURRENT_VERSION\" != \"$LATEST_VERSION\" ] && [ -n \"$LATEST_VERSION\" ]; then\n      echo \"\U0001F4E6 Update available: $CURRENT_VERSION → $LATEST_VERSION\"\n      echo \"   Updating markdownlint...\"\n      npm update -g markdownlint-cli\n    fi\n  elif command -v brew &> /dev/null && brew list markdownlint-cli &>/dev/null; then\n    if brew outdated | grep -q \"^markdownlint-cli\"; then\n      echo \"\U0001F4E6 Updating markdownlint...\"\n      brew upgrade markdownlint-cli\n    fi\n  fi\n  exit 0\nfi\n\n# Try to install with npm first (most universal)\nif command -v npm &> /dev/null; then\n  echo \"\U0001F4E6 Installing markdownlint with npm...\"\n  if npm install -g markdownlint-cli 2>/dev/null; then\n    echo \"✅ markdownlint installed successfully with npm\"\n  else\n    echo \"⚠️  Failed to install with npm - trying with sudo...\"\n    echo \"You may be prompted for your password:\"\n    if sudo npm install -g markdownlint-cli; then\n      echo \"✅ markdownlint installed successfully with sudo\"\n    else\n      echo \"❌ Failed to install markdownlint with npm\"\n      echo \"\"\n      echo \"Alternative: Install to user directory:\"\n      echo \"  npm install --prefix ~/.npm-global markdownlint-cli\"\n      echo \"  export PATH=~/.npm-global/bin:\\$PATH\"\n      exit 1\n    fi\n  fi\n# Try Homebrew as fallback\nelif command -v brew &> /dev/null; then\n  echo \"\U0001F4E6 Installing markdownlint with Homebrew...\"\n  brew install markdownlint-cli\nelse\n  echo \"❌ Neither npm nor Homebrew found\"\n  echo \"\"\n  echo \"Please install Node.js or Homebrew first:\"\n  echo \"  - Node.js: https://nodejs.org/\"\n  echo \"  - Homebrew: https://brew.sh/\"\n  exit 1\nfi\n\n# Verify installation\nif command -v markdownlint &> /dev/null; then\n  echo \"\"\n  echo \"✅ markdownlint installed successfully!\"\n  echo \"   Version: $(markdownlint --version)\"\nelse\n  echo \"❌ Installation failed\"\n  exit 1\nfi\n"
  pr:fix:
    desc: Fix PR documentation formatting
    silent: true
    cmds:
      - "echo \"\U0001F4DD Fixing PR documentation...\"\npr_file=$(find . -name \"pr.*.md\" | head -1)\nif [ -n \"$pr_file\" ]; then\n  echo \"Found PR file: $pr_file\"\n  markdownlint \"$pr_file\" --fix\n  echo \"✅ PR documentation fixed\"\nelse\n  echo \"No PR documentation found (pr.*.md)\"\nfi"
